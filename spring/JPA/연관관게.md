- 방향 : 객체 관계에서는 단방향, 양방향이 가능하지만 테이블에서는 항상 양방향이다.

## 단방향 연관관계

멤버와 팀은 다대일 관계일 때 단방향으로 연관관계를 맺어보자.

``` java
@Entity 
public class Member {

  @Id
  @Column(name = "MEMBER_ID")
  private String id;

  private String username;

  @ManyToOne
  @JoinColum(name = "TEAM_ID")
  private Team team;
}

@Entity
public class Team {

  @Id
  @Column(name = "TEAM_ID")
  private String id;

  private String name;
}
```
이렇게 단방향으로 매핑을 걸면 유저에서 팀을 조회할 수 있지만 팀은 유저를 조회하지 못한다.

***

## 양방향 연관관계

아까와 같은 테이블에서 객체 연관관계를 정리하면 아래와 같다.
- 멤버 --> 팀
- 팀 --> 멤버
 
양방향 관계를 매핑한 코드는 위 코드의 `Team`클래스에서 아래와 같은 코드를 추가해주면 된다.

``` java
@OneToMany(mappedBy = "team")
private List<Member> members = new ArrayList<Member>();
```

***

## 연관관계 주인
테이블은 외래 키 하나로 두 테이블의 연관관계를 관리한다. 엔티티를 단방향으로 매핑하면 참조를 하나만 사용하므로 이 참조로 외래 키를 관리하면 된다.   
하지만 양방향은 참조가 두 개이기 때문에 둘 중에 하나만 사용하여 외래 키를 관리해야 한다.

**여기서 둘 중에 하나만 정해서 외래키를 관리하는 것이 연관관계의 주인이다.**

- 주인만 외래 키를 관리(등록, 수정 등)할 수 있다.
- 주인이 아닌 쪽은 읽기만 할 수 있다.
- 주인을 정하는 방법은 `mappedBy` 속성을 사용하면 된다.
- 주인이 아닌 쪽에 `mappedBy` 속성을 사용하면 된다.

### 연관관계의 주인은 외래 키가 있는 곳
연관관계의 주인은 외래 키가 있는데 위 테이블에서 teamId라는 외래 키를 관리하는 곳은 Member 클래스 이므로 주인은 Member의 team 필드가 된다.

***

## 양방향 주의점

- 주인이 아닌 곳에서 값을 입력하면 외래 키의 값이 저장되지 않는다.

결론은 양방향 관계를 안전하게 쓰기 위해선 양쪽 모두 값을 넣어줘야 한다.

연관관계를 변경할 때는 기존 연관관계가 있으면 삭제하고 추가 해야한다.

***

## 정리
- 단방향 매핑만으로 테이블과 객체의 연관관계 매핑은 이미 완료되었다.
- 단방향을 양방향으로 만들면 반대방향으로 객체 그래프 탐색 기능이 추가된다.
- 양방향 연관관계를 매핑하려면 객체에서 양쪽 방향을 모두 관리해야 한다.